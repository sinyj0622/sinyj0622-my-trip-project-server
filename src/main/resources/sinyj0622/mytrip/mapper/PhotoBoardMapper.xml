<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="PhotoBoardMapper">

	<resultMap type="PhotoBoard" id="PhotoBoardMap">
		<id column="photo_id" property="no" />
		<result column="titl" property="title" />
		<result column="cdt" property="createdDate" />
		<result column="vw_cnt" property="viewCount" />
		
		<association property="plan" javaType="Plan">
			<id column="plan_id" property="no" />
			<result column="plan_spot" property="Destnation" />
			<result column="plan_titl" property="travelTitle" />
		</association>
		
		<collection property="files" ofType="PhotoFile">
		<id column="photo_file_id" property="no" />
    <result column="file_path" property="filepath" />
		</collection>
		
	</resultMap>


	<select id="selectPhotoBoard" resultMap="PhotoBoardMap" parameterType="int">
		select
		photo_id,
		titl,
		cdt,
		vw_cnt
		from mytrip_photo
		 where plan_id=#{no}
	</select>

	<insert id="insertPhotoBoard" parameterType="PhotoBoard"
	useGeneratedKeys="true" keyColumn="photo_id" keyProperty="no">
		insert 
		into mytrip_photo(titl,plan_id)
		 values(#{title},#{plan_no})
	</insert>

	<select id="detailPhotoBoard" resultMap="PhotoBoardMap" parameterType="int">
		select
		p.photo_id,
		p.titl,
		p.cdt,
		p.vw_cnt,
		n.plan_id,
		n.titl plan_title
		  from mytrip_photo p
		  inner join mytrip_plan n on p.plan_id=n.plan_id
		   where photo_id=#{no}
	</select>

	<update id="updatePhotoBoard" parameterType="PhotoBoard">
		update
		 mytrip_photo
		  set
		   titl=#{title}
		    where photo_id=#{no}
	</update>
	<delete id="deletePhotoBoard" parameterType="int">
		delete
		 from mytrip_photo
		  where photo_id=#{no}
		  	</delete>
</mapper>







